;??  ?8
;------------------------------------------------------------------------------
; ??????????? ????'?????
; ????????:    1) ??? ??? ?????????? ?????? ?????? ?? ?????
;                 ?????????? ????? ??????? ?????, ???? ????????? ?????
;                ? ????????? ? ????????????? ?????????? DOC.
;              2) ????????? ???????????????? ???????????? ?????? 7,
;                ? ???? ?????? ????????? ?????????? ??????, ?????? ?????
;                ? ????? ? ???????? ?????????? ?? ???????? ?? 7.

; ???:          ???? "???"
; ?????????:    ????
; ????:         1
; ?????:        ??-01
;------------------------------------------------------------------------------
; ????:         06.05.2021
;---------------------------------
;I.????????? ????????
TITLE  MyIcon.exe
IDEAL           ; ????????? - ??? ????????? tasm 
MODEL small     ; ????????? - ??? ?????? ??????? 
STACK 1024  ; ????????? - ?????? ????? 
                
                ;II.??????? ???????? ????? 
DATASEG
    topRow equ 08  ; ??????? ????????? ????????? ??????????? ?????????
    botROw equ 13
    leftCol equ 25
    currRow db 00       ; ??????? ?????? ??? ?????????? ????????? ????? ????
    menu db 0c9h, 25 DUP(0cdh),0bbh         ; ??????? ???? ????
    db 0bah,'Show our group           ',0bah
    db 0bah, 'Count                    ', 0bah
    db 0bah, 'Listen something amazing ', 0bah
    db 0bah, 'Exit                     ', 0bah
    db 0c8h, 25 DUP(0cdh),0bch
    help db  'To select item use Arrow up/down'         ; ????????? ?????-????????
    db 'end then press enter.'
    db 10,13,'Press Esc to exit.'
    msg1 db "Group N 3: Iryna, Andriy, Vlad",10,13,'$' ; ???? ?????
    buffStart db 254

    exCode db 0 ; ???????? ???
;---------------??????? ????---------------
CODESEG

Start:
    mov ax,@data    ; @data ?????????????, ?? ??????????? ?????????? model
    mov ds, ax  ; ???????????? ??????? ???????? ????? ? ??????? ds
    mov es, ax  ; ????????????? ???????? ES
    call clear      ; ?????????? ????????? ?????????? ???????? ????
    call printMenu  ;   ????????? ????
    inerface:
    
    call waiting    ; ?????????? ? ????? ?????????? ??? ???????????
    call clear      ; ???????? ?????
    call printMenu      ; ??????????? ????
    
    cmp currRow,topRow+1        ; ??????????? ????? ???????????
    je showGroup                ; ?????????? ?? ?????? ????? ?????
    
    cmp currRow,topRow+2
    je count                    ; ?????????? ?? ?????????? ??????
    
    cmp currRow,topRow+3
    je sound                    ; ?????????? ?? ????????? ?????
    
    cmp currRow,topRow+4
    je exit                     ; ?????????? ?? ????? ??????
    
    jmp inerface                ; ??????? ??????????? ????? ?????????? ??????
    
    showGroup:
    mov currRow,0               ; ????????? ???????? ?????
    call show                   ; ????????? ???? ?????
    jmp inerface                ; ?????????? ????????? ???????????
    
    count:
    mov currRow,0           
    call execute                ; ????????? ?????????
    jmp inerface
    
    sound:
    mov currRow,0
    call beep                   ; ????????? ????
    jmp inerface
    
    exit:
    mov ah,4ch                  ; ?????????? ????????
    mov al,[exCode]
    int 21h
;-------------?????????----------------
    proc clear
    push ax     ; ????????????? ??? ????????, ? ????? ?????? ?????????
    push cx
    push bx
    push dx
    mov ax, 0600h           ; ??????? ???????, ?? ???????? ??? ?????
    mov bh,30h              ; ??????? ????? ????
    mov cx,00               ; ??????? ???????? ????????? ?????? ???? ????
    mov dx, 184Fh           ; ??????? ???????? ??????? ???????? ???? ????
    int 10h                 ; ?????????? ??????? ???????
    mov ax,1300h            ; ??????? ??????? ????????? ????? ?? ?????
    mov bx,71h              ; ????? ?????
    lea bp,[help]           ; ??????? ?????? ?????
    mov cx, 72              ; ??????? ?????
    mov dh,botROw+8         ; ?????, ?? ???? ???? ???????????
    mov dl, 0               ; ???????, ?? ??????????? ?????? ?????? ?????
    int 10h                 ; ?????????? ??????? ??????
    pop dx                  ; ?????????? ????????
    pop bx
    pop cx
    pop ax
    ret
    endp
    
    proc printMenu
    push ax             
    push cx
    push bx
    push dx
    mov ax,1300h            ; ??????? ??????? ?????? ?????
    mov bx,71h              ; ??????? ????? ?????
    lea bp,[menu]           ; ?????? ?????
    mov cx, 27              ; ???? ???????
    mov dh,topRow           ; ?????????? ???????
    mov dl, leftCol
    Q: 
    int 10h                 ; ?????? ???????
    add bp,27               ; ??????? ?? ?????????? ?????
    inc dh                  ; ???????? ?? ????? ?? ??????
    cmp dh,botROw+1         ; ???? ?? ????? ?? ?????????? - 
    jne Q                   ; ??????????? ??????
    pop dx
    pop bx
    pop cx
    pop ax
    ret
    endp
    
    proc waiting
    mov currRow,topRow          ; ??????? ????????? ?????
    w: mov ah, 08h              ; ??????? ??????? ?????????? ???????
    int 21h                     ; ?????????? ??
    cmp al,0                    ; ?????????? ?? ??????? ?????????? ???????????? ????????? ASCII
    jne skip                    ; ????, ?? ?????????? ?? ?????? ????????? ????? ??????
    int 21h                     ; ???? ??????? ?????????? ??????????? ???? ASCII, ?????????? ????
    cmp al,50h                  ; ???? ??????? - ??????? ????, ?????????? ?? ???????? ?????
    je up
    cmp al,48h                  ; ???? ??????? ????? - ?? ???????????? ?????
    je down
    skip:                       ; ???? ? ??????? ? ???????????? ?????????
    cmp al,1Bh                  ; ???? ?? ESC - ???????? ? ????????
    jne skip2
    mov ah, 4ch
    mov al,[exCode]
    int 21h
    skip2:
    cmp al, 0Dh                 ; ???? ?? Enter -  ???????????? ? ????? ??????? ????? ?????????
    jne w
    ret
    
    up:
    mov bh,currRow              ; ????????? ? ??????? ???????? ?????
    inc bh                      ; ?????????? ???? ?????
    cmp bh,botROw               ; ???????????, ?? ?? ???????? ??? ?? ????
    jnl zero
    mov currRow,bh              ; ??????? ???? ???????? ????????? ?????
    jmp last                    ; ?????????? ?? ???? ??????
    
    down:
    mov bh,currRow              
    dec bh                      ; ??? ???? ????????? ?????, ??? ????????? ???? ?????
    cmp bh,topRow               ; ??????????? ?? ?? ???????? ??? ?? ????
    jng max
    mov currRow,bh              ; ??????? ???? ????????
    jmp last
    
    max:
    mov currRow,botROw-1        ; ??? ?????????? ???????? ????, ??????? ????????? ?????
    jmp last
    
    zero:
    mov currRow,topRow+1        ; ??? ?????????? ??????? - ??????? ??????? ?????
    last:
    push dx                     
    push bx
    push ax
    push cx
    mov ax,1300h                ; ??????? ???????, ??? ???????????? ????, ??? ????????? ?????????? ??????????
    lea bp,[menu]               
    mov dh, topRow
    mov cx, 27
    mov dl, leftCol
    Q1:
    mov bx,71h                  ; ??????? ????? ?? ?????????????
    cmp dh,currRow              ; ???? ???????? ?? ????????? ?????, ?????????? ???????
    jne stateColor
    mov bx,17h
    stateColor:
    int 10h                     
    add bp,27
    inc dh
    cmp dh,botROw+1
    jne Q1
    pop cx
    pop ax
    pop bx
    pop dx
    jmp w
    endp
    
    proc show
    push ax
    push cx
    push bx
    push dx
    mov ax,1300h            ; ??????? ??????? ?????? ?????
    mov bx,71h              ; ??????? ?????
    lea bp,[msg1]           ; ??????? ????????
    mov cx, 30              ; ???????????? ???????
    mov dh,topRow-4         ; ?????????? ???????
    mov dl, 10
    int 10h                 ; ????? ?????
    pop dx
    pop bx
    pop cx
    pop ax
    ret
    endp
    
    PROC execute

        mov ax, -7 ; ????? ?1 ?? ??

        mov bx, 3 ; ?????? ?2 ?? bx
        add ax, bx ; ????????? ?1 ? ?2
        
        mov bx, 2 ; ????? ?3 ?? bx
        imul bx ; ??????? ?? ?3

        mov bl, 4 ; ????? ?4 ?? bl
        idiv bl ; ??????? ?? ?4
        
        mov bl, 3 ; ????? ?5 ?? bl
        add al, bl ; ????????? ?5

        add al, '0' ; ??????????? ? ?????? 
        mov [ES:0201h], ' ' ; ????? ?????? ?? ES
        mov [ES:0202h], ' ' ; ????? ?????? ?? ES
        mov [ES:0203h], al ; ????? ?????? ?? ES
        mov [ES:0204h], ' ' ; ????? ?????? ?? ES
        mov [ES:0205h], ' ' ; ????? ?????? ?? ES
        push ax
        push cx
        push bx
        push dx
        mov ax,1300h            ; ??????? ??????
        mov bx,71h              ; ????? ????????????
        lea bp,[ES:0201h]       ; ?????? ?????
        mov cx, 5               ; ??????? ????? ?? ??????
        mov dh,topRow-4         ; ?????????? ???????
        mov dl, 10              
        int 10h                 ; ????? ??????????
        pop dx
        pop bx
        pop cx
        pop ax
        ret
    endp
    
    PROC beep
        in al, 61h ; ???????? ???? ????????
        push ax ; ?????????? ????
        or al, 3
        out 61h, al
        or al, 10110110b ; ???????????? ???? ??? ?????? 
        out 43h, al ; ????????? ???????
        mov ax, 4000 ; ??????? ?????
        out 42h, al ; ????????? ??????, ???? ????? ???????? ?? ????????
        mov al, ah  ; ah -> al
        out 42h, al ; ????????? ???????? ?????
        
        mov cx,0030h ;?????? ????? ?????
        mov dx,0000h ; ??????? ????? ?????
        mov ah,86h ; ??????? 86h
        int 15h ; ?????


        pop ax ; ????????? ????????? ????
        and AL, 11111100B ; ???????? ??? ???????? ????
        out 61h, AL ; ????????? ????????
        ret
    endp beep
end Start
    
    
            